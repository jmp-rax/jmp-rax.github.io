---
layout: post
title: "Serial Peripheral Interface"
date: 2022-01-10 23:22:00 -0400
categories: SPI embedded protocol note
---

> This article is a personal note I took to help remember the gist of SPI

# SPI

**Serial Peripheral Interface**

```
>> Traditional 4wire SPI << 

Data being written
cs ‾‾‾‾|__________________|‾‾‾‾‾‾‾‾ cs

Tx        0 1 0 1 0 1 0 1
mosi ‾‾‾|_|‾|_|‾|_|‾|_|‾‾‾‾‾‾‾‾‾‾‾‾‾ sdi

Rx        1 0 1 0 1 0 1 0 
miso ‾‾‾‾‾‾|_|‾|_|‾|_|‾|_|‾‾‾‾‾‾‾‾‾‾ sdo

clock pulse
sck ‾|_|‾|_|‾|_|‾|_|‾|_|‾|_|‾|_|‾|_ sck
```

## Overview

> Serial peripheral interface (SPI) is one of the most widely used interfaces between microcontroller and peripheral ICs such as sensors, ADCs, DACs, shift registers, SRAM, and others. This article provides a brief description of the SPI interface followed by an introduction to Analog Devices’ SPI enabled switches and muxes, and how they help reduce the number of digital GPIOs in system board design.
> 
> <cite> https://www.analog.com/en/analog-dialogue/articles/introduction-to-spi-interface.html</cite>

Traditional 4 wire SPI has four signals

- Clock (CLK)
- Chip Select (CS)
- Master out, Slave In (MOSI)
- Master In, Slave Out (MISO)

## Clock Signal

The clock signal is generated by the *master* and the *slave* is synchronized to the *master*. SPI Devices support much higher clock frequencies compared to I<sup>2</sup>C. Product data sheets should specify supported frequencies.

## Chip Select

Chip select is used to select the slave. Normally this is performed by pulling a chip select wire from its normal high state low (ground).

## Data Transmission

> In SPI, the master can select the clock polarity and clock phase. The CPOL bit sets the polarity of the clock signal during the idle state. The idle state is defined as the period when CS is high and transitioning to low at the start of the transmission and when CS is low and transitioning to high at the end of the transmission. The CPHA bit selects the clock phase. Depending on the CPHA bit, the rising or falling clock edge is used to sample and/or shift the data. The master must select the clock polarity and clock phase, as per the requirement of the slave. Depending on the CPOL and CPHA bit selection, four SPI modes are available.

See <cite>https://www.analog.com/en/analog-dialogue/articles/introduction-to-spi-interface.html</cite> for a configuration list

## Multislave Configuration

```
Regular SPI Mode
            ┌───────────────────────────────────────>┐
            |┌─────────────────────────>┐         ┌──┴───┐
 _________  ||                       ┌──┴───┐     |  CS  |
|     CS0 ├>┘|          |‾‾‾‾‾‾|     |  CS  | ┌──>┤ SCLK |
| M   CS1 ├>─┘┌────────>┤ CS   | ┌──>┤ SCLK | |┌─>┤ SDI  |
| A   CS2 ├>──┘     ┌──>┤ SCLK | |┌─>┤ SDI  | ||┌<┤ SDO  |
| S       |         |┌─>┤ SDI  | ||┌<┤ SDO  | ||| |______|
| T       |         ||┌<┤ SDO  | ||| |______| |||
| E  SCLK ├>───┐    ||| |______| |||          |||
| R MOSI  ├>─┐ └────┴))──────────┴))──────────┘||  
|   MISO  ├<┐└───────┴)───────────┴)───────────┘|
 ‾‾‾‾‾‾‾‾‾  └─────────┴────────────┴────────────┘
```

```
Daisy Chain SPI Mode
            ┌───────────────────────────────────────>┐
            |┌─────────────────────────>┐         ┌──┴───┐
 _________  ||                       ┌──┴───┐     |  CS  |
|     CS0 ├>┘|          |‾‾‾‾‾‾|     |  CS  | ┌──>┤ SCLK |
| M   CS1 ├>─┘┌────────>┤ CS   | ┌──>┤ SCLK | |┌─>┤  SDI |
| A   CS2 ├>──┘     ┌──>┤ SCLK | |   | SDI  ├<⌒⌒─<┤  SDO |
| S       |         |   | SDI  ├<⌒───┤ SDO  | ||  |______|
| T       |         | ┌<┤ SDO  | |   |______| ||
| E  SCLK ├>───┐    | | |______| |            ||
| R MOSI> ├>─┐ └────┴─)──────────┴────────────┘| 
|   MISO< ├<┐└────────)────────────────────────┘
 ‾‾‾‾‾‾‾‾‾  └─────────┘
```

## 3 Wire SPI

In 3 Wire SPI, instead of being full duplex the transmission / receive line acts as half duplex with the input/output is shared or the peripheral device may not transmit.

## Quad SPI

In a Quad SPI mode, a master and its peripheral will have multiple data lines allowing for much faster data transmission than traditional 4 wire SPI.

<cite> https://www.totalphase.com/blog/2020/05/what-are-the-differences-of-single-vs-dual-vs-quad-spi/</cite>